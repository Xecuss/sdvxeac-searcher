var ee=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var N=(s,e,t)=>e in s?ee(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,j=(s,e)=>{for(var t in e||(e={}))ae.call(e,t)&&N(s,t,e[t]);if(R)for(var t of R(e))le.call(e,t)&&N(s,t,e[t]);return s},T=(s,e)=>te(s,se(e));var y=(s,e,t)=>(N(s,typeof e!="symbol"?e+"":e,t),t);import{d as C,r as oe,o as u,c as _,a as i,w as ne,t as h,F as M,b as V,n as b,e as ce,f as X,g as re,p as O,h as B,i as P,E as ie,j as ue,k as de,l as L,m,q as p,u as w,s as $,v as F,x as pe,y as fe,z as _e,A as me,B as ve,C as he,D as ge,G as ke,H as ye,I as Ie,J as Se,K as we,L as Fe,M as Ce}from"./vendor.b515490c.js";const Me=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}};Me();var E=(s,e)=>{const t=s.__vccOpts||s;for(const[a,l]of e)t[a]=l;return t};const Ve=s=>(O("data-v-93e874fa"),s=s(),B(),s),be={class:"content"},Le={class:"cover"},$e={class:"name"},Ee={class:"artist"},De={class:"difficulties"},Ne={class:"package"},Oe={class:"categorys"},Be={key:0,class:"btn-group"},Pe=["onClick"],He=Ve(()=>i("button",{class:"copy"},"Copy",-1)),Ae=C({__name:"MusicItem",props:{data:{},selected:{type:Boolean},optEnable:{type:Boolean}},emits:["select-click"],setup(s,{emit:e}){const t=()=>{e("select-click")};return(a,l)=>{const o=oe("lazy");return u(),_("div",{class:"music-item",style:re({paddingBottom:a.optEnable?"30px":"0"})},[i("div",be,[ne(i("img",Le,null,512),[[o,`https://p.eagate.573.jp${a.data.cover}`]]),i("h3",$e,h(a.data.name),1),i("p",Ee,h(a.data.artist),1),i("div",De,[(u(!0),_(M,null,V(a.data.difficulties,n=>(u(),_("div",{key:n.id,class:b(["difficulty",n.name])},h(n.name)+" "+h(n.level),3))),128))]),i("p",Ne,h(a.data.pacakge),1),i("div",Oe,[(u(!0),_(M,null,V(a.data.category,n=>(u(),_("div",{key:n,class:b(["category",n])},h(n),3))),128))]),a.optEnable?(u(),_("div",Be,[i("button",{class:b(["select",{selected:a.selected}]),onClick:ce(t,["stop"])}," Select ",10,Pe),He])):X("",!0)])],4)}}});var Ue=E(Ae,[["__scopeId","data-v-93e874fa"]]);const ze={class:"multiselect-list"},Re=["onClick"],je={class:"text"},Te={key:0},Xe=C({__name:"SelectList",props:{options:{},modelValue:{}},emits:["update:modelValue"],setup(s,{emit:e}){const t=s,a=l=>{t.modelValue.includes(l)?e("update:modelValue",t.modelValue.filter(o=>o!==l)):e("update:modelValue",[...t.modelValue,l])};return(l,o)=>(u(),_("div",ze,[(u(!0),_(M,null,V(l.options,n=>(u(),_("div",{key:n.value,class:b(["select-option",{"is-selected":l.modelValue.includes(n.value)}]),onClick:c=>a(n.value)},[i("div",je,h(n.label),1),n.sub!==void 0?(u(),_("div",Te,h(n.sub),1)):X("",!0)],10,Re))),128))]))}});var H=E(Xe,[["__scopeId","data-v-ee302c12"]]);const J=s=>{try{const e=localStorage.getItem(s);return e?JSON.parse(e):null}catch{return null}},Je=(s,e)=>{localStorage.setItem(s,JSON.stringify(e))},xe=s=>s.startsWith("\u30B3\u30CA\u30B9\u30C6\u7248 SOUND VOLTEX")?s.replace("\u30B3\u30CA\u30B9\u30C6\u7248 SOUND VOLTEX",""):s;const Ke=s=>(O("data-v-94254bb6"),s=s(),B(),s),qe=Ke(()=>i("h3",{class:"header"},"Filter",-1)),Ge=C({__name:"FilterDrawer",props:{packInfo:{},cateInfo:{},packFilters:{},cateFilters:{},diffFilters:{}},emits:["update:packFilters","update:cateFilters","update:diffFilters"],setup(s,{emit:e}){const t=s,a=c=>c.map(r=>({value:r.id,label:xe(r.name),sub:r.count.toString()})),l=P(()=>a(t.packInfo)),o=P(()=>a(t.cateInfo)),n=Array(20).fill(1).map((c,r)=>({value:r+1,label:`Lv.${r+1}`}));return(c,r)=>{const g=ie,I=ue,S=de;return u(),L(S,{direction:"ltr",size:"80%"},{header:m(()=>[qe]),default:m(()=>[p(I,{accordion:""},{default:m(()=>[p(g,{title:"Package"},{default:m(()=>[p(H,{"model-value":c.packFilters,options:l.value,"onUpdate:modelValue":r[0]||(r[0]=k=>c.$emit("update:packFilters",k))},null,8,["model-value","options"])]),_:1}),p(g,{title:"Difficulty"},{default:m(()=>[p(H,{"model-value":c.diffFilters,options:w(n),"onUpdate:modelValue":r[1]||(r[1]=k=>c.$emit("update:diffFilters",k))},null,8,["model-value","options"])]),_:1}),p(g,{title:"Category"},{default:m(()=>[p(H,{"model-value":c.cateFilters,options:o.value,"onUpdate:modelValue":r[2]||(r[2]=k=>c.$emit("update:cateFilters",k))},null,8,["model-value","options"])]),_:1})]),_:1})]),_:1})}}});var We=E(Ge,[["__scopeId","data-v-94254bb6"]]);function Qe(){var n;const s=$(new Set((n=J("selected-music"))!=null?n:[])),e=()=>{pe(()=>{Je("selected-music",[...s])})},t=F(!1);let a=0;return{selectedMusic:s,initSelectedMusic:e,displayHidden:t,titleClickHandle:()=>{a++,a>5&&(t.value=!0)},selectMusic:c=>{s.has(c)?s.delete(c):s.add(c)}}}const x=new fe([],{keys:["name","artist"]}),Ye=(s,{pack:e})=>{if(!e.length)return s;const t=new Set(e);return s.filter(a=>t.has(a.package))},Ze=(s,{cate:e})=>{if(!e.length)return s;const t=new Set(e);return s.filter(a=>{for(let l of a.category)if(t.has(l))return!0;return!1})},et=(s,{difficulties:e})=>{if(console.log(">>>> searchDiff",e),!e.length)return s;const t=new Set(e);return s.filter(a=>{for(let l of a.difficulties)if(t.has(l.l))return!0;return!1})},tt=(s,{keyword:e})=>e.trim().length?(x.setCollection(s),x.search(e).map(t=>t.item)):s,st=s=>s.reduceRight((e,t)=>(a,l)=>t(e(a,l),l),e=>e),K=202402011738,at=async(s,e)=>{const t=localStorage.getItem(e);if(t){const o=JSON.parse(t);if(console.log(o.version,K),o.version>=K)return o}const l=await(await fetch(`${s}?r=${new Date().valueOf()}`)).json();return localStorage.setItem(e,JSON.stringify(l)),l};function lt(s,e){const t=new Map;for(const a of s){let l=t.get(a.package);l===void 0&&(l=[],t.set(a.package,l)),l.push(a)}return[...t].map(a=>{var I,S;const[l,o]=a,n=((I=e.get(l))==null?void 0:I.count)||1,c=o.length,r=n!==void 0?c/n:0,g=o.reduce((k,D)=>k+D.difficulties.slice(-1)[0].l,0)/c;return{name:((S=e.get(l))==null?void 0:S.name)||"",favCount:c,favPer:r,avgLevel:g}}).sort((a,l)=>a.favPer!==l.favPer?l.favPer-a.favPer:l.avgLevel-a.avgLevel)}const ot="x-sdvx-songdb",nt={0:"NOV",1:"ADV",2:"EXH",3:"INF",4:"GRV",5:"HVN",6:"VVD",7:"XCD",8:"MXM"};class A{constructor(e,t){y(this,"packIdMap",new Map);y(this,"cateIdMap",new Map);y(this,"musicsIdMap",new Map);y(this,"musics",[]);y(this,"filter",e=>e);y(this,"__raw");this.musics=e.musics,this.__raw=e,e.packInfo.forEach(a=>this.packIdMap.set(a.id,a)),e.cateInfo.forEach(a=>this.cateIdMap.set(a.id,a)),e.musics.forEach(a=>this.musicsIdMap.set(a.id,a)),t&&this.setFilter(t)}get packInfo(){return this.__raw.packInfo}get cateInfo(){return this.__raw.cateInfo}get allSongs(){return this.mapToLegacy(this.musics)}setFilter(e){this.filter=st(e)}mapToLegacy(e){return e.map(t=>{var a;return T(j({},t),{difficulties:t.difficulties.map((l,o)=>({id:o,name:nt[l.n.toString()]||"",level:l.l})),pacakge:((a=this.packIdMap.get(t.package))==null?void 0:a.name)||"",category:t.category.map(l=>{var o;return((o=this.cateIdMap.get(l))==null?void 0:o.name)||""}),cover:"/game/sdvx/vi/common/jacket.html?img="+t.cover})})}search(e){const t=this.filter(this.musics,e);return this.mapToLegacy(t)}statSelect(e){const t=e.map(a=>this.musicsIdMap.get(a));return lt(t,this.packIdMap)}static async createSearcher(e){const t=await at(e,ot),a=[Ye,Ze,et,tt];return new A(t,a)}}const ct=s=>(O("data-v-38d64c71"),s=s(),B(),s),rt=ct(()=>i("h2",{class:"main-title"},"\u30B3\u30CA\u30B9\u30C6\u7248 SDVX \u697D\u66F2\u691C\u7D22",-1)),it={class:"search-bar"},ut={class:"setting-row"},dt={class:"total"},pt={class:"musics"},ft="filter2",_t=C({__name:"MainPage",setup(s){var z;let e;const t=$({keyword:"",pack:(z=J(ft))!=null?z:[],cate:[],difficulties:[]}),a=F([]),l=F(0),o=F(!1),n=F(!1);F(!1);const c=$([]),r=$([]),{selectedMusic:g,selectMusic:I,initSelectedMusic:S,displayHidden:k,titleClickHandle:D}=Qe(),U=()=>{if(!e)return;const v=e.search(t);l.value=v.length,a.value=v.slice(0,200)};P(()=>{const v=[...g];return e?e.statSelect(v):[]}),A.createSearcher("./music_db_final.json").then(v=>{e=v,c.push(...v.packInfo),r.push(...v.cateInfo),U(),S()}),_e(t,me(()=>{U()},200));const q=()=>{o.value=!o.value};return(v,f)=>{const G=ve,W=he,Q=ge,Y=ke,Z=ye;return u(),L(Z,null,{default:m(()=>[p(We,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=d=>o.value=d),"pack-filters":t.pack,"onUpdate:packFilters":f[1]||(f[1]=d=>t.pack=d),"cate-filters":t.cate,"onUpdate:cateFilters":f[2]||(f[2]=d=>t.cate=d),"diff-filters":t.difficulties,"onUpdate:diffFilters":f[3]||(f[3]=d=>t.difficulties=d),"pack-info":c,"cate-info":r},null,8,["modelValue","pack-filters","cate-filters","diff-filters","pack-info","cate-info"]),p(G,{height:"40px",onClick:w(D)},{default:m(()=>[rt]),_:1},8,["onClick"]),p(Y,null,{default:m(()=>[i("div",it,[p(W,{modelValue:t.keyword,"onUpdate:modelValue":f[4]||(f[4]=d=>t.keyword=d),type:"text",placeholder:"keyword...","prefix-icon":w(Ie)},null,8,["modelValue","prefix-icon"])]),i("div",ut,[p(Q,{type:"primary",icon:w(we),onClick:q},{default:m(()=>[Se("Filter")]),_:1},8,["icon"])]),i("p",dt,"total "+h(l.value)+" songs",1),i("div",pt,[(u(!0),_(M,null,V(a.value,d=>(u(),L(Ue,{key:d.id,data:d,selected:w(g).has(d.id),"opt-enable":n.value,onSelectClick:ht=>w(I)(d.id)},null,8,["data","selected","opt-enable","onSelectClick"]))),128))])]),_:1})]),_:1})}}});var mt=E(_t,[["__scopeId","data-v-38d64c71"]]);const vt=C({__name:"App",setup(s){return(e,t)=>(u(),L(mt))}});Fe(vt).use(Ce,{error:"",loading:""}).mount("#app");
