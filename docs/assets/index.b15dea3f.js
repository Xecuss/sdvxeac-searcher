var ae=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var N=(s,e,t)=>e in s?ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,j=(s,e)=>{for(var t in e||(e={}))ne.call(e,t)&&N(s,t,e[t]);if(z)for(var t of z(e))ce.call(e,t)&&N(s,t,e[t]);return s},X=(s,e)=>le(s,oe(e));var S=(s,e,t)=>(N(s,typeof e!="symbol"?e+"":e,t),t);import{d as C,r as re,o as u,c as _,a as r,w as J,t as m,F as M,b as V,n as b,e as ie,f as x,g as ue,p as O,h as A,i as B,E as de,j as pe,k as fe,l as L,m as v,q as p,u as w,s as $,v as F,x as _e,y as me,z as ve,A as he,B as ge,C as ke,D as ye,G as Ie,H as Se,I as we,J as Fe,K as Ce,L as Me,M as Ve,N as be}from"./vendor.ac476ecb.js";const Le=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}};Le();var E=(s,e)=>{const t=s.__vccOpts||s;for(const[a,l]of e)t[a]=l;return t};const $e=s=>(O("data-v-93e874fa"),s=s(),A(),s),Ee={class:"content"},De={class:"cover"},Ne={class:"name"},Oe={class:"artist"},Ae={class:"difficulties"},Be={class:"package"},Pe={class:"categorys"},He={key:0,class:"btn-group"},Ue=["onClick"],Re=$e(()=>r("button",{class:"copy"},"Copy",-1)),Te=C({__name:"MusicItem",props:{data:{},selected:{type:Boolean},optEnable:{type:Boolean}},emits:["select-click"],setup(s,{emit:e}){const t=()=>{e("select-click")};return(a,l)=>{const o=re("lazy");return u(),_("div",{class:"music-item",style:ue({paddingBottom:a.optEnable?"30px":"0"})},[r("div",Ee,[J(r("img",De,null,512),[[o,`https://p.eagate.573.jp${a.data.cover}`]]),r("h3",Ne,m(a.data.name),1),r("p",Oe,m(a.data.artist),1),r("div",Ae,[(u(!0),_(M,null,V(a.data.difficulties,n=>(u(),_("div",{key:n.id,class:b(["difficulty",n.name])},m(n.name)+" "+m(n.level),3))),128))]),r("p",Be,m(a.data.pacakge),1),r("div",Pe,[(u(!0),_(M,null,V(a.data.category,n=>(u(),_("div",{key:n,class:b(["category",n])},m(n),3))),128))]),a.optEnable?(u(),_("div",He,[r("button",{class:b(["select",{selected:a.selected}]),onClick:ie(t,["stop"])}," Select ",10,Ue),Re])):x("",!0)])],4)}}});var ze=E(Te,[["__scopeId","data-v-93e874fa"]]);const je={class:"multiselect-list"},Xe=["onClick"],Je={class:"text"},xe={key:0},Ke=C({__name:"SelectList",props:{options:{},modelValue:{}},emits:["update:modelValue"],setup(s,{emit:e}){const t=s,a=l=>{t.modelValue.includes(l)?e("update:modelValue",t.modelValue.filter(o=>o!==l)):e("update:modelValue",[...t.modelValue,l])};return(l,o)=>(u(),_("div",je,[(u(!0),_(M,null,V(l.options,n=>(u(),_("div",{key:n.value,class:b(["select-option",{"is-selected":l.modelValue.includes(n.value)}]),onClick:c=>a(n.value)},[r("div",Je,m(n.label),1),n.sub!==void 0?(u(),_("div",xe,m(n.sub),1)):x("",!0)],10,Xe))),128))]))}});var P=E(Ke,[["__scopeId","data-v-ee302c12"]]);const K=s=>{try{const e=localStorage.getItem(s);return e?JSON.parse(e):null}catch{return null}},qe=(s,e)=>{localStorage.setItem(s,JSON.stringify(e))},Ge=s=>s.startsWith("\u30B3\u30CA\u30B9\u30C6\u7248 SOUND VOLTEX")?s.replace("\u30B3\u30CA\u30B9\u30C6\u7248 SOUND VOLTEX",""):s;const We=s=>(O("data-v-94254bb6"),s=s(),A(),s),Qe=We(()=>r("h3",{class:"header"},"Filter",-1)),Ye=C({__name:"FilterDrawer",props:{packInfo:{},cateInfo:{},packFilters:{},cateFilters:{},diffFilters:{}},emits:["update:packFilters","update:cateFilters","update:diffFilters"],setup(s,{emit:e}){const t=s,a=c=>c.map(i=>({value:i.id,label:Ge(i.name),sub:i.count.toString()})),l=B(()=>a(t.packInfo)),o=B(()=>a(t.cateInfo)),n=Array(20).fill(1).map((c,i)=>({value:i+1,label:`Lv.${i+1}`}));return(c,i)=>{const k=de,y=pe,I=fe;return u(),L(I,{direction:"ltr",size:"80%"},{header:v(()=>[Qe]),default:v(()=>[p(y,{accordion:""},{default:v(()=>[p(k,{title:"Package"},{default:v(()=>[p(P,{"model-value":c.packFilters,options:l.value,"onUpdate:modelValue":i[0]||(i[0]=h=>c.$emit("update:packFilters",h))},null,8,["model-value","options"])]),_:1}),p(k,{title:"Difficulty"},{default:v(()=>[p(P,{"model-value":c.diffFilters,options:w(n),"onUpdate:modelValue":i[1]||(i[1]=h=>c.$emit("update:diffFilters",h))},null,8,["model-value","options"])]),_:1}),p(k,{title:"Category"},{default:v(()=>[p(P,{"model-value":c.cateFilters,options:o.value,"onUpdate:modelValue":i[2]||(i[2]=h=>c.$emit("update:cateFilters",h))},null,8,["model-value","options"])]),_:1})]),_:1})]),_:1})}}});var Ze=E(Ye,[["__scopeId","data-v-94254bb6"]]);function et(){var n;const s=$(new Set((n=K("selected-music"))!=null?n:[])),e=()=>{_e(()=>{qe("selected-music",[...s])})},t=F(!1);let a=0;return{selectedMusic:s,initSelectedMusic:e,displayHidden:t,titleClickHandle:()=>{a++,a>5&&(t.value=!0)},selectMusic:c=>{s.has(c)?s.delete(c):s.add(c)}}}const q=new me([],{keys:["name","artist"]}),tt=(s,{pack:e})=>{if(!e.length)return s;const t=new Set(e);return s.filter(a=>t.has(a.package))},st=(s,{cate:e})=>{if(!e.length)return s;const t=new Set(e);return s.filter(a=>{for(let l of a.category)if(t.has(l))return!0;return!1})},at=(s,{difficulties:e})=>{if(console.log(">>>> searchDiff",e),!e.length)return s;const t=new Set(e);return s.filter(a=>{for(let l of a.difficulties)if(t.has(l.l))return!0;return!1})},lt=(s,{keyword:e})=>e.trim().length?(q.setCollection(s),q.search(e).map(t=>t.item)):s,ot=s=>s.reduceRight((e,t)=>(a,l)=>t(e(a,l),l),e=>e),H=202403210902;window.DATA_VERSION=String(H);const nt=async(s,e)=>{const t=localStorage.getItem(e);if(t){const o=JSON.parse(t);if(console.log(o.version,H),o.version>=H)return o}const l=await(await fetch(`${s}?r=${new Date().valueOf()}`)).json();return localStorage.setItem(e,JSON.stringify(l)),l};function ct(s,e){const t=new Map;for(const a of s){let l=t.get(a.package);l===void 0&&(l=[],t.set(a.package,l)),l.push(a)}return[...t].map(a=>{var y,I;const[l,o]=a,n=((y=e.get(l))==null?void 0:y.count)||1,c=o.length,i=n!==void 0?c/n:0,k=o.reduce((h,D)=>h+D.difficulties.slice(-1)[0].l,0)/c;return{name:((I=e.get(l))==null?void 0:I.name)||"",favCount:c,favPer:i,avgLevel:k}}).sort((a,l)=>a.favPer!==l.favPer?l.favPer-a.favPer:l.avgLevel-a.avgLevel)}const rt="x-sdvx-songdb",it={0:"NOV",1:"ADV",2:"EXH",3:"INF",4:"GRV",5:"HVN",6:"VVD",7:"XCD",8:"MXM"};class U{constructor(e,t){S(this,"packIdMap",new Map);S(this,"cateIdMap",new Map);S(this,"musicsIdMap",new Map);S(this,"musics",[]);S(this,"filter",e=>e);S(this,"__raw");this.musics=e.musics,this.__raw=e,e.packInfo.forEach(a=>this.packIdMap.set(a.id,a)),e.cateInfo.forEach(a=>this.cateIdMap.set(a.id,a)),e.musics.forEach(a=>this.musicsIdMap.set(a.id,a)),t&&this.setFilter(t)}get packInfo(){return this.__raw.packInfo}get cateInfo(){return this.__raw.cateInfo}get allSongs(){return this.mapToLegacy(this.musics)}setFilter(e){this.filter=ot(e)}mapToLegacy(e){return e.map(t=>{var a;return X(j({},t),{difficulties:t.difficulties.map((l,o)=>({id:o,name:it[l.n.toString()]||"",level:l.l})),pacakge:((a=this.packIdMap.get(t.package))==null?void 0:a.name)||"",category:t.category.map(l=>{var o;return((o=this.cateIdMap.get(l))==null?void 0:o.name)||""}),cover:"/game/sdvx/vi/common/jacket.html?img="+t.cover})})}search(e){const t=this.filter(this.musics,e);return this.mapToLegacy(t)}statSelect(e){const t=e.map(a=>this.musicsIdMap.get(a));return ct(t,this.packIdMap)}static async createSearcher(e){const t=await nt(e,rt),a=[tt,st,at,lt];return new U(t,a)}}const ut=s=>(O("data-v-69c09236"),s=s(),A(),s),dt=ut(()=>r("h2",{class:"main-title"},"\u30B3\u30CA\u30B9\u30C6\u7248 SDVX \u697D\u66F2\u691C\u7D22",-1)),pt={class:"search-bar"},ft={class:"setting-row"},_t={class:"total"},mt={class:"loading"},vt={class:"musics"},ht="filter2",gt=C({__name:"MainPage",setup(s){var T;let e;const t=$({keyword:"",pack:(T=K(ht))!=null?T:[],cate:[],difficulties:[]}),a=F([]),l=F(0),o=window.DATA_VERSION.slice(0,-4),n=F(!0),c=F(!1),i=F(!1);F(!1);const k=$([]),y=$([]),{selectedMusic:I,selectMusic:h,initSelectedMusic:D,displayHidden:It,titleClickHandle:G}=et(),R=()=>{if(!e)return;const g=e.search(t);l.value=g.length,a.value=g.slice(0,200)};B(()=>{const g=[...I];return e?e.statSelect(g):[]}),U.createSearcher("./music_db_final.json").then(g=>{e=g,k.push(...g.packInfo),y.push(...g.cateInfo),R(),D(),n.value=!1}),ve(t,he(()=>{R()},200));const W=()=>{c.value=!c.value};return(g,f)=>{const Q=ge,Y=ke,Z=ye,ee=Ie,te=Se,se=we;return u(),L(te,null,{default:v(()=>[p(Ze,{modelValue:c.value,"onUpdate:modelValue":f[0]||(f[0]=d=>c.value=d),"pack-filters":t.pack,"onUpdate:packFilters":f[1]||(f[1]=d=>t.pack=d),"cate-filters":t.cate,"onUpdate:cateFilters":f[2]||(f[2]=d=>t.cate=d),"diff-filters":t.difficulties,"onUpdate:diffFilters":f[3]||(f[3]=d=>t.difficulties=d),"pack-info":k,"cate-info":y},null,8,["modelValue","pack-filters","cate-filters","diff-filters","pack-info","cate-info"]),p(Q,{height:"40px",onClick:w(G)},{default:v(()=>[dt]),_:1},8,["onClick"]),p(ee,null,{default:v(()=>[r("div",pt,[p(Y,{modelValue:t.keyword,"onUpdate:modelValue":f[4]||(f[4]=d=>t.keyword=d),type:"text",placeholder:"keyword...","prefix-icon":w(Fe)},null,8,["modelValue","prefix-icon"])]),r("div",ft,[p(Z,{type:"primary",icon:w(Me),onClick:W},{default:v(()=>[Ce("Filter")]),_:1},8,["icon"])]),r("p",_t,[r("span",null,"total "+m(l.value)+" songs",1),r("span",null,"update on "+m(w(o)),1)]),J(r("div",mt,null,512),[[se,n.value,void 0,{fullscreen:!0,lock:!0}]]),r("div",vt,[(u(!0),_(M,null,V(a.value,d=>(u(),L(ze,{key:d.id,data:d,selected:w(I).has(d.id),"opt-enable":i.value,onSelectClick:St=>w(h)(d.id)},null,8,["data","selected","opt-enable","onSelectClick"]))),128))])]),_:1})]),_:1})}}});var kt=E(gt,[["__scopeId","data-v-69c09236"]]);const yt=C({__name:"App",setup(s){return(e,t)=>(u(),L(kt))}});Ve(yt).use(be,{error:"",loading:""}).mount("#app");
